<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/standards/Arbitrator.js | @kleros/archon</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="A javascript library for Ethereum dispute resolution. Provides the ability to interface with Arbitrable and Arbitrator Ethereum smart contracts, as defined in ERC 792."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="@kleros/archon"><meta property="twitter:description" content="A javascript library for Ethereum dispute resolution. Provides the ability to interface with Arbitrable and Arbitrator Ethereum smart contracts, as defined in ERC 792."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Archon.js~Archon.html">Archon</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#standards">standards</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/standards/Arbitrable.js~Arbitrable.html">Arbitrable</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/standards/Arbitrator.js~Arbitrator.html">Arbitrator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/standards/StandardContract.js~StandardContract.html">StandardContract</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utils">utils</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/EventListener.js~EventListener.html">EventListener</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-multihashFile">multihashFile</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-validMultihash">validMultihash</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-validateFileFromURI">validateFileFromURI</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isRequired">isRequired</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getHttpUri">getHttpUri</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getURIProtocol">getURIProtocol</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getURISuffix">getURISuffix</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/standards/Arbitrator.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import ArbitratorContractInterface from &apos;kleros-interaction/build/contracts/Arbitrator&apos;

import EventListener from &apos;../utils/EventListener&apos;
import isRequired from &apos;../utils/isRequired&apos;
import * as arbitratorConstants from &apos;../constants/arbitrator&apos;
import * as errorConstants from &apos;../constants/error&apos;

import StandardContract from &apos;./StandardContract&apos;

/**
 * Provides interaction with standard Arbitrable contracts
 */
class Arbitrator extends StandardContract {
  // enums and constants
  DisputeStatus = arbitratorConstants.DisputeStatus

  /**
   * Load an arbitrable web3 contract instance
   * @param {string} contractAddress - Address of the Arbitrable contract.
   * @returns {object} web3 contract instance
   */
  _loadContractInstance = contractAddress =&gt;
    new this.web3.eth.Contract(ArbitratorContractInterface.abi, contractAddress)

  /**
   * Fetch the arbitration cost.
   * @param {string} contractAddress - The address of the arbitrator contract.
   * @param {stirng} extraData - Hex string representing the extra data for the dispute.
   * @returns {number} The arbitration cost in WEI
   */
  getArbitrationCost = async (
    contractAddress = isRequired(&apos;contractAddress&apos;),
    extraData = &apos;0x0&apos;
  ) =&gt; {
    const contractInstance = this._loadContractInstance(contractAddress)

    return contractInstance.methods.arbitrationCost(extraData).call()
  }

  /**
   * Fetch the appeal cost.
   * @param {string} contractAddress - The address of the arbitrator contract.
   * @param {number} disputeID - The index of the dispute.
   * @param {stirng} extraData - Hex string representing the extra data for the dispute.
   * @returns {number} The appeal cost in WEI
   */
  getAppealCost = async (
    contractAddress = isRequired(&apos;contractAddress&apos;),
    disputeID = isRequired(&apos;disputeID&apos;),
    extraData = &apos;0x0&apos;
  ) =&gt; {
    const contractInstance = this._loadContractInstance(contractAddress)

    return contractInstance.methods.appealCost(disputeID, extraData).call()
  }

  /**
   * Fetch the current ruling.
   * @param {string} contractAddress - The address of the arbitrator contract.
   * @param {number} disputeID - The index of the dispute.
   * @returns {number} The current ruling of the dispute.
   */
  getCurrentRuling = async (
    contractAddress = isRequired(&apos;contractAddress&apos;),
    disputeID = isRequired(&apos;disputeID&apos;)
  ) =&gt; {
    const contractInstance = this._loadContractInstance(contractAddress)

    return contractInstance.methods.currentRuling(disputeID).call()
  }

  /**
   * Fetch the current ruling.
   * @param {string} contractAddress - The address of the arbitrator contract.
   * @param {number} disputeID - The index of the dispute.
   * @returns {string} The status of the dispute.
   */
  getDisputeStatus = async (
    contractAddress = isRequired(&apos;contractAddress&apos;),
    disputeID = isRequired(&apos;disputeID&apos;)
  ) =&gt; {
    const contractInstance = this._loadContractInstance(contractAddress)

    return contractInstance.methods.disputeStatus(disputeID).call()
  }

  /**
   * Fetch the data from the DisputeCreation event log. This includes the arbitrable contract,
   * the blockNumber, transactionHash and the createdAt timestamp.
   * @param {string} contractAddress - The address of the arbitrator contract.
   * @param {number} disputeID - The index of the dispute.
   * @param {object} options - Additional arguments such as toBlock and fromBlock.
   * @returns {object} Data from the dispute creation log.
   */
  getDisputeCreation = async (
    contractAddress = isRequired(&apos;contractAddress&apos;),
    disputeID = isRequired(&apos;disputeID&apos;),
    options = {}
  ) =&gt; {
    const contractInstance = this._loadContractInstance(contractAddress)

    const disputeCreationLog = await EventListener.getEventLogs(
      contractInstance,
      &apos;DisputeCreation&apos;,
      options.fromBlock || 0,
      options.toBlock || &apos;latest&apos;,
      { _disputeID: disputeID, ...options.filters }
    )

    if (!disputeCreationLog[0])
      throw new Error(
        errorConstants.CONTRACT_ERROR(
          `No record of dispute creation for dispute ${disputeID}`
        )
      )

    if (disputeCreationLog.length &gt; 1)
      throw new Error(
        errorConstants.CONTRACT_ERROR(
          `More than one record of dispute creation for dispute ${disputeID}`
        )
      )

    const creationLog = disputeCreationLog[0]
    const createdAt = (await new Promise((resolve, reject) =&gt; {
      this.web3.eth.getBlock(creationLog.blockNumber, (error, result) =&gt; {
        if (error) reject(error)

        resolve(result)
      })
    })).timestamp

    const args = await creationLog.returnValues
    return {
      createdAt,
      arbitrableContract: args._arbitrable,
      blockNumber: creationLog.blockNumber,
      transactionHash: creationLog.transactionHash
    }
  }

  /**
   * Fetch the data from the AppealDecision event log. This includes the arbitrable contract,
   * the blockNumber, transactionHash and the createdAt timestamp.
   * @param {string} contractAddress - The address of the arbitrator contract.
   * @param {number} disputeID - The index of the dispute.
   * @param {number} appealNumber - The number of the appeal.
   * @param {object} options - Additional arguments such as toBlock and fromBlock.
   * @returns {object} Data from the appeal decision log.
   */
  getAppealDecision = async (
    contractAddress = isRequired(&apos;contractAddress&apos;),
    disputeID = isRequired(&apos;disputeID&apos;),
    appealNumber = isRequired(&apos;appealNumber&apos;),
    options = {}
  ) =&gt; {
    if (appealNumber &lt; 1)
      throw new Error(
        errorConstants.PARAMETER_ERROR(`Appeal Number must be &gt;= 1`)
      )

    const contractInstance = this._loadContractInstance(contractAddress)

    const appealDecisionLog = await EventListener.getEventLogs(
      contractInstance,
      &apos;AppealDecision&apos;,
      options.fromBlock || 0,
      options.toBlock || &apos;latest&apos;,
      { _disputeID: disputeID, ...options.filters }
    )

    const appealLog = appealDecisionLog[appealNumber - 1]
    if (!appealLog)
      throw new Error(
        errorConstants.CONTRACT_ERROR(
          `No record of appeal number ${appealNumber} for dispute ${disputeID}`
        )
      )

    const appealedAt = (await new Promise((resolve, reject) =&gt; {
      this.web3.eth.getBlock(appealLog.blockNumber, (error, result) =&gt; {
        if (error) reject(error)

        resolve(result)
      })
    })).timestamp

    const args = await appealLog.returnValues
    return {
      appealedAt,
      arbitrableContract: args._arbitrable,
      blockNumber: appealLog.blockNumber,
      transactionHash: appealLog.transactionHash
    }
  }
}

export default Arbitrator
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
